#!/usr/bin/python

import platform, os, sys, getpass, hashlib
try: 
    import GSMT
except Exception as e:
    print "Can't load main library!"
    print "ERROR: " + str(e)
    sys.exit()
libMain = GSMT.GSMT.main()
print "Welcome to GMST " + str(libMain.version) + " (c) Filip Dobrovolny 2013"
print "==============================================="
if platform.system() != "Linux":
    print "Sorry platform: " + platform.system() + " is not supported yet :("
    print "Do you have supported platform and still showing this message plese contact us."
    sys.exit()
print "Platform: OK"
# if not root...kick out
if not os.geteuid()==0:
    sys.exit("\nOnly root can run this script\n")
print "Root: OK"

def makeConf():
    file = open('/etc/GSMT/config', 'w')
    file.write("# This is config of GSMT "+ str(libMain.version) + " (c) Filip Dobrovolny 2013")
    file.close()
    print '/etc/GSMT/config created: OK'
try:
   with open('/etc/GSMT/config'): pass
except IOError as e:
   if os.path.exists("/etc/GSMT"):
       print 'GSMT alredy exists.'
       print 'If GSMT not exists, please try remove /etc/GSMT folder.'
       sys.exit()
   print "/etc/GSMT not exist: OK"
else:
   print 'GSMT alredy exists.'
   print 'If GSMT not exists, please try remove /etc/GSMT folder.'
   print 'In other case please report bug.'
   sys.exit()
try:
    os.mkdir("/etc/GSMT")
    makeConf()
except Exeption, e:
    print "Uknown error at creating /etc/GSMT folder. Please report bug."
    print "ERROR: " + str(e) + " " + str(e.name)
    sys.exit()

print "/etc/GSMT created: OK"
def exit():
    os.remove("/etc/GSMT")
    sys.exit()
try:
    os.mkdir("/etc/GSMT/games")
except Exeption, e:
    print "Uknown error at creating /etc/GSMT/games folder. Please report bug."
    print "ERROR: " + str(e) + " " + str(e.name)
    exit()
print "/etc/GSMT/games created: OK"
try:
    os.mkdir("/etc/GSMT/modules")
except Exeption, e:
    print "Uknown error at creating /etc/GSMT/modules folder. Please report bug."
    print "ERROR: " + str(e) + " " + str(e.name)
    exit()
print "/etc/GSMT/modules created: OK"
print "please create superuser:"
name = raw_input("name:")
while True:
    password1 = getpass.getpass()
    if password1 == "q":
        print "Exitting ..."
        print "Create superuser: Failed"
        exit()
        break
    password2 = getpass.getpass("RePassword: ")
    if len(password1) < 5:
        print "Password must be 5 or more characters length!"
    elif password1 == password2:
        break
    else:
        print "Password aren't same please try it again. Press q to exit."
libMain.createSQLite()
encryptedPassword = hashlib.md5()
encryptedPassword = encryptedPassword.update(password1).hexdigest()

try:
    libMain.sqlite.create(name, encryptedPassword)
except Exeption, e:
    print "Uknown error at creating sqlite database. Please report bug."
    print "ERROR: " + str(e) + " " + str(e.name)
    exit()
print "SQLite created: OK"
print "Superuser created: OK"
print "============================="
print "Finished !"
